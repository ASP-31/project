<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Incident History | Air Quality System</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>

<body class="bg-slate-100 min-h-screen flex flex-col">

<!-- HEADER -->
<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3 font-bold text-xl">
      <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-xl flex items-center justify-center text-white">
        <svg viewBox="0 0 24 24" class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M2 12h10" />
          <path d="M9 18h3a3 3 0 0 0 3-3V9a3 3 0 0 1 3-3h3" />
          <path d="M12 12a3 3 0 0 1 3 3v3" />
        </svg>
      </div>
      <span class="bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-700">
        Air Quality <span class="text-blue-600">System</span>
      </span>
    </div>

    <nav class="flex gap-8 text-slate-600 font-medium">
      <a href="dashboard.html">Dashboard</a>
      <a href="incident.html">Incident</a>
      <a href="map.html">Map</a>
      <a href="history.html" class="text-blue-600 font-semibold">History</a>
    </nav>
  </div>
</header>

<!-- CONTENT -->
<main class="max-w-6xl mx-auto px-6 py-10 space-y-8 flex-grow">

  <!-- HEADER -->
  <section class="flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-extrabold">Incident History</h1>
      <p class="text-slate-600 text-sm">
        Pollution incidents investigated by the user
      </p>
    </div>

    <button
      onclick="clearHistory()"
      class="px-5 py-2 rounded-xl bg-red-600 text-white font-semibold shadow hover:bg-red-700 transition">
      Clear History
    </button>
  </section>

  <!-- TABLE -->
  <section class="bg-white rounded-2xl shadow border border-slate-200 overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-4 text-left">Station</th>
          <th class="p-4 text-left">PM2.5</th>
          <th class="p-4 text-left">AQI</th>
          <th class="p-4 text-left">Severity</th>
          <th class="p-4 text-left">Timestamp</th>
          <th class="p-4 text-right">Actions</th>
        </tr>
      </thead>
      <tbody id="historyTable" class="divide-y"></tbody>
    </table>
  </section>

  <!-- EMPTY STATE -->
  <p id="emptyState" class="text-center text-slate-500 hidden">
    No incident history available
  </p>

</main>

<!-- FOOTER -->
<footer class="bg-slate-900 text-slate-300 mt-20">
  <div class="text-center py-6 text-sm border-t border-slate-700">
    Â© 2026 Ernakulam Air Quality Project
  </div>
</footer>

<!-- STORAGE SERVICE -->
<script src="services/storage.js"></script>

<!-- SCRIPT -->
<script>
  const table = document.getElementById('historyTable');
  const emptyState = document.getElementById('emptyState');

  let history = StorageService.getHistory();

  function severityFromAQI(aqi) {
    if (aqi > 200) return 'Severe';
    if (aqi > 100) return 'Moderate';
    return 'Low';
  }

  function renderHistory() {
    table.innerHTML = '';

    if (history.length === 0) {
      emptyState.classList.remove('hidden');
      return;
    }

    emptyState.classList.add('hidden');

    history.forEach((item, index) => {
      table.innerHTML += `
        <tr>
          <td class="p-4 font-medium">${item.station}</td>
          <td class="p-4">${item.pm25}</td>
          <td class="p-4">${item.aqi}</td>
          <td class="p-4 font-semibold">${severityFromAQI(item.aqi)}</td>
          <td class="p-4">${new Date(item.timestamp).toLocaleString()}</td>
          <td class="p-4 text-right space-x-2">
            <button
              onclick="viewIncident(${index})"
              class="px-3 py-1 rounded-lg bg-blue-600 text-white text-xs font-semibold">
              View
            </button>
            <button
              onclick="deleteIncident(${index})"
              class="px-3 py-1 rounded-lg bg-slate-200 text-slate-700 text-xs font-semibold">
              Delete
            </button>
          </td>
        </tr>
      `;
    });
  }

  function deleteIncident(index) {
    StorageService.deleteFromHistory(index);
    history = StorageService.getHistory();
    renderHistory();
  }

  function clearHistory() {
    if (!confirm('Are you sure you want to clear all history?')) return;
    StorageService.clearHistory();
    history = [];
    renderHistory();
  }

  function viewIncident(index) {
    StorageService.setActiveIncident(history[index]);
    window.location.href = 'map.html';
  }

  renderHistory();
</script>

</body>
</html>


