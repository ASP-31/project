<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Incident Report | Air Quality System</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }

    /* Print optimization */
    @media print {
      button, nav, header { display: none; }
      body { background: white; }
    }
  </style>
</head>

<body class="bg-slate-100">

<!-- HEADER -->
<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3 font-bold text-xl">
      <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-emerald-500 rounded-xl flex items-center justify-center text-white">
        <svg viewBox="0 0 24 24" class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 12h10" />
            <path d="M9 18h3a3 3 0 0 0 3-3V9a3 3 0 0 1 3-3h3" />
            <path d="M12 12a3 3 0 0 1 3 3v3" />
        </svg>
      </div>
      <span class="bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-700">Air Quality <span class="text-blue-600">System</span></span>
    </div>
    <nav class="flex gap-8 text-slate-600 font-medium">
      <a href="dashboard.html">Dashboard</a>
      <a href="incident.html">Incident</a>
      <a href="map.html">Map</a>
      <a href="#" class="text-blue-600 font-semibold">Report</a>
    </nav>
  </div>
</header>

<!-- CONTENT -->
<main class="max-w-5xl mx-auto px-6 py-10 space-y-10">

  <!-- TITLE -->
  <section class="bg-white rounded-2xl shadow p-8 border border-slate-200">
    <h1 class="text-3xl font-extrabold mb-2">Air Pollution Incident Report</h1>
    <p class="text-slate-600 text-sm">
      Generated on <span id="reportDate"></span>
    </p>
  </section>

  <!-- INCIDENT SUMMARY -->
  <section class="bg-white rounded-2xl shadow p-8 border border-slate-200">
    <h2 class="text-xl font-bold mb-4">Incident Summary</h2>

    <div class="grid md:grid-cols-2 gap-6 text-sm text-slate-700">
      <div>
        <p><strong>Monitoring Station:</strong> <span id="stationName">—</span></p>
        <p><strong>PM2.5 Level:</strong> <span id="pm25">—</span> µg/m³</p>
        <p><strong>PM10 Level:</strong> <span id="pm10">—</span> µg/m³</p>
      </div>
      <div>
        <p><strong>AQI:</strong> <span id="aqi">—</span></p>
        <p><strong>Severity:</strong> <span id="severity" class="font-semibold">—</span></p>
        <p><strong>Data Source:</strong> <span id="source">—</span></p>
      </div>
    </div>
  </section>

  <!-- SUSPECTED SOURCES -->
  <section class="bg-white rounded-2xl shadow p-8 border border-slate-200">
    <h2 class="text-xl font-bold mb-4">Identified Probable Sources</h2>

    <table class="w-full text-sm border border-slate-200 rounded-xl overflow-hidden">
      <thead class="bg-slate-100">
        <tr>
          <th class="p-3 text-left">Site Name</th>
          <th class="p-3 text-left">Category</th>
          <th class="p-3 text-left">Distance (km)</th>
          <th class="p-3 text-left">Confidence</th>
        </tr>
      </thead>
      <tbody id="suspectTable" class="divide-y">
        <tr>
          <td class="p-3" colspan="4" class="text-center text-slate-500">
            No suspected sources available
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- CONCLUSION -->
  <section class="bg-gradient-to-br from-blue-50 to-white border border-blue-200 rounded-2xl p-8">
    <h2 class="text-xl font-bold text-blue-700 mb-3">Conclusion</h2>
    <p class="text-sm text-slate-700">
      Based on observed particulate matter spikes, spatial proximity,
      and environmental correlations, the listed locations have been
      identified as potential contributors to the incident.
      Immediate inspection and mitigation actions are recommended.
    </p>
  </section>

  <!-- ACTIONS -->
  <section class="flex justify-end gap-4">
    <button onclick="window.print()"
      class="px-6 py-3 rounded-xl bg-emerald-600 text-white font-semibold shadow hover:shadow-lg transition">
      Download / Print Report
    </button>
  </section>

</main>

<!-- FOOTER -->
<footer class="bg-slate-900 text-slate-300 mt-20">
  <div class="text-center py-6 text-sm border-t border-slate-700">
    © 2026 Ernakulam Air Quality Project
  </div>
</footer>

<!-- SCRIPT -->
<script>
  const report = JSON.parse(localStorage.getItem('incidentReport'));

  document.getElementById('reportDate').innerText =
    new Date().toLocaleString();

  if (!report) {
    console.warn("No report data found in localStorage");
  } else {
    document.getElementById('stationName').innerText = report.station || '—';
    document.getElementById('pm25').innerText = report.pm25 || '—';
    document.getElementById('pm10').innerText = report.pm10 || '—';
    document.getElementById('aqi').innerText = report.aqi || '—';
    document.getElementById('source').innerText = report.source || '—';

    const severity =
      report.aqi > 200 ? 'Severe' :
      report.aqi > 100 ? 'Moderate' : 'Low';

    document.getElementById('severity').innerText = severity;

    const table = document.getElementById('suspectTable');
    table.innerHTML = '';

    (report.suspects || []).forEach(s => {
      const confidence =
        s.distance < 1 ? 'High' :
        s.distance < 3 ? 'Medium' : 'Low';

      table.innerHTML += `
        <tr>
          <td class="p-3">${s.name}</td>
          <td class="p-3">${s.type}</td>
          <td class="p-3">${s.distance}</td>
          <td class="p-3 font-semibold">${confidence}</td>
        </tr>
      `;
    });
  }
</script>

</body>
</html>
