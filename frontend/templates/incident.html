<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Incident Log | Air Quality System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-10">
  <main class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-10">
        <h1 class="text-3xl font-black italic">INCIDENT LOG FILE</h1>
        <button onclick="localStorage.removeItem('incidentHistory'); location.reload();" 
        class="text-xs font-bold text-red-500 hover:underline">
            CLEAR ALL LOGS
        </button>
    </div>

    <div id="logContainer" class="space-y-6">
        </div>
  </main>

  <script src="services/storage.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
        // 1. Pull the cumulative list
        const log = StorageService.getHistory();

        if (log.length === 0) {
            document.getElementById("logContainer").innerHTML = "<p class='text-slate-400'>No incidents recorded yet.</p>";
            return;
        }

        // 2. Sort by highest AQI first
        const sortedLog = log.sort((a, b) => b.aqi - a.aqi);

        // 3. Render the list
        document.getElementById("logContainer").innerHTML = sortedLog.map(inc => `
            <div class="bg-white border-l-4 border-red-500 shadow-sm p-6 rounded-r-xl">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-xl font-bold">${inc.station}</h2>
                        <p class="text-sm text-slate-500">Detected at: ${inc.spikeDetectedAt}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-black text-red-600">AQI ${inc.aqi}</div>
                        <div class="text-xs font-bold text-slate-400 uppercase">PM2.5: ${inc.pm25}</div>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-50">
                    <span class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Primary Suspect</span>
                    <p class="font-bold text-slate-800">${inc.suspects[0].name} (${inc.suspects[0].aiScore}% Match)</p>
                </div>
            </div>
        `).join('');
    });
  </script>
</body>
</html>